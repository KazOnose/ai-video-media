---
// src/pages/features/[page].astro
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths({ paginate }) {
  const allFeatures = (await getCollection('blog'))
    .filter(post => post.data.type === 'feature')
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(allFeatures, { pageSize: 10 });
}

const { page } = Astro.props;
const title = `特集記事一覧 - ${page.currentPage}ページ目`;
const description = "AI Strategic Insightが送る、次世代のコンテンツ戦略と実践プロセスを深掘りする特集記事一覧です。";
---

<Layout title={title} description={description}>
  <main class="main-container">
    <nav class="breadcrumb">
        <a href="/">Top</a> <span class="separator">&gt;</span> <strong class="current">Features</strong>
    </nav>

    <div class="layout-grid">
        <div class="main-content-area">
            <section class="main-board">
                <header class="archive-header">
                    <h1 class="archive-title">Features <span class="feature-sub">- 特集記事 -</span></h1>
                    <p class="article-count">{page.total} 件の特集</p>
                </header>
                
                <div class="feature-list">
                    {page.data.map((post) => (
                        <a href={`/blog/${post.id.replace(/\.mdx?$/, '')}/`} class="feature-card">
                            <div class="feature-image-wrapper">
                                <img src={post.data.heroImage || "https://placehold.co/800x450?text=No+Image"} alt="" />
                                <div class="feature-card-overlay">
                                    <span class="feature-card-date">
                                        {post.data.pubDate.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '/')}
                                    </span>
                                </div>
                            </div>
                            <div class="feature-card-content">
                                <h2 class="feature-card-title">{post.data.title}</h2>
                                <p class="feature-card-description">{post.data.description}</p>
                                <span class="read-more">記事を読む →</span>
                            </div>
                        </a>
                    ))}
                </div>

                {page.lastPage > 1 && (
                    <nav class="pagination">
                        {page.url.prev && <a href={page.url.prev} class="page-arrow">&lt;</a>}
                        {Array.from({ length: page.lastPage }, (_, i) => i + 1).map((num) => (
                            <a href={`/features/${num}/`} class={`page-number ${page.currentPage === num ? 'active' : ''}`}>{num}</a>
                        ))}
                        {page.url.next && <a href={page.url.next} class="page-arrow">&gt;</a>}
                    </nav>
                )}
            </section>
        </div>

        <Sidebar />
    </div>
  </main>
</Layout>

<style is:global>
    .main-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 32px;
        font-size: 0.85rem;
        font-weight: 600;
        color: #64748b;
    }
    .breadcrumb a { text-decoration: none; color: #0284c7; }
    .breadcrumb .separator { color: #cbd5e1; }
    .breadcrumb .current { color: #1e293b; }

    .layout-grid {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 40px;
    }

    .main-content-area { min-width: 0; }
    .main-board { 
        background: #ffffff; 
        border: 1px solid #e2e8f0; 
        border-radius: 16px; 
        padding: 40px; 
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
    }

    .archive-header { 
        margin-bottom: 48px; 
        border-bottom: 4px solid #1e293b; 
        padding-bottom: 16px; 
    }
    .archive-title { 
        font-size: 2.2rem; 
        font-weight: 900; 
        color: #1e293b; 
        margin: 0 0 8px 0; 
        letter-spacing: -0.02em; 
    }
    .feature-sub { font-size: 1rem; margin-left: 12px; color: #64748b; font-weight: 700; }
    .article-count { 
        font-size: 0.9rem; 
        color: #1e293b; 
        font-weight: 800; 
        border-left: 4px solid #0284c7; 
        padding-left: 12px; 
        margin: 0; 
    }

    .feature-list { display: flex; flex-direction: column; gap: 48px; }
    .feature-card { 
        text-decoration: none; 
        color: inherit; 
        display: flex; 
        flex-direction: column;
        gap: 24px; 
        border-bottom: 1px solid #f1f5f9; 
        padding-bottom: 48px; 
        transition: all 0.3s; 
    }
    .feature-card:last-child { border-bottom: none; }
    .feature-card:hover { transform: translateY(-5px); }
    .feature-card:hover .feature-card-title { color: #0284c7; }

    .feature-image-wrapper { 
        position: relative;
        width: 100%; 
        aspect-ratio: 21 / 9; 
        border-radius: 16px; 
        overflow: hidden; 
        background: #f1f5f9; 
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .feature-image-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
    .feature-card:hover .feature-image-wrapper img { transform: scale(1.03); }
    
    .feature-card-overlay {
        position: absolute;
        top: 20px;
        left: 20px;
    }
    .feature-card-date {
        background: rgba(30, 41, 59, 0.8);
        color: #fff;
        font-size: 0.8rem;
        font-weight: 800;
        padding: 6px 12px;
        border-radius: 6px;
        backdrop-filter: blur(4px);
    }

    .feature-card-content { flex: 1; }
    
    .feature-card-title { font-size: 1.8rem; font-weight: 900; line-height: 1.3; margin: 0 0 16px 0; color: #0f172a; letter-spacing: -0.01em; }
    .feature-card-description { 
        font-size: 1.1rem; 
        color: #475569; 
        margin: 0 0 20px 0; 
        line-height: 1.7; 
    }
    .read-more {
        font-size: 0.95rem;
        font-weight: 800;
        color: #0284c7;
        display: inline-block;
    }

    .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 56px; }
    .page-number, .page-arrow { 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        width: 48px; 
        height: 48px; 
        border: 2px solid #e2e8f0; 
        border-radius: 14px; 
        text-decoration: none; 
        color: #1e293b; 
        font-weight: 800; 
        transition: all 0.2s; 
    }
    .page-number.active { background: #1e293b; color: #fff; border-color: #1e293b; }

    @media (max-width: 1024px) {
        .layout-grid { grid-template-columns: 1fr; }
        .feature-image-wrapper { aspect-ratio: 16 / 9; }
        .feature-card-title { font-size: 1.5rem; }
    }
</style>
